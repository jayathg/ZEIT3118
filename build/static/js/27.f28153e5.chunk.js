"use strict";(self.webpackChunkpoc=self.webpackChunkpoc||[]).push([[27],{951:(t,e,i)=>{i.d(e,{D:()=>ie,S:()=>X});var n=i(326),o=i(710);const r="undefined"!=typeof localStorage,s=r&&localStorage.getItem("base.content.url")||"https://static.descope.com/pages",a="config.json",l="base.ui.components.url",d=r&&localStorage.getItem(l)||"https://static.descope.com/npm/@descope/web-components-ui@<version>/dist/umd/index.js",c=r&&localStorage.getItem(l)||"https://cdn.jsdelivr.net/npm/@descope/web-components-ui@<version>/dist/umd/index.js",u="descope-login-flow",h="code",g="ra-challenge",p="ra-callback",f="ra-backup-callback",v="ra-initiator",m="data-exclude-field",b="dls_last_auth",y="state_id",w="saml_idp_state_id",I="saml_idp_username",k="descope_idp_initiated",A="sso_app_id",C="oidc_login_hint",S="data-type",E="poll",x="webauthnCreate",j="submit",U="polling",O=["descope-multi-select-combo-box","descope-text-area"];var L,T;function W(t){return new URLSearchParams(window.location.search).get(t)}function H(t){if(window.history.replaceState&&W(t)){const e=new URL(window.location.href),i=new URLSearchParams(e.search);i.delete(t),e.search=i.toString(),window.history.replaceState({},"",e.toString())}}function R(t,e){return(0,n.sH)(this,void 0,void 0,(function*(){const i=yield fetch(t,{cache:"default"});if(!i.ok)throw Error("Error fetching URL ".concat(t," [").concat(i.status,"]"));return{body:yield i[e||"text"](),headers:Object.fromEntries(i.headers.entries())}}))}function M(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"v2-beta";const n=new URL(s);return n.pathname=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.join("/").replace(/\/+/g,"/")}(n.pathname,t,i,e),n.toString()}function G(t,e){if(!Number.isNaN(t)&&!Number.isNaN(e))return t>e?L.forward:t<e?L.backward:void 0}(T=L||(L={})).backward="backward",T.forward="forward";const P=()=>{const[t="",e=""]=(W(u)||"").split("_");return{executionId:t,stepId:e}};function D(){H(u)}const N=t=>t.replace(/-./g,(t=>t[1].toUpperCase())),q=()=>{const{executionId:t,stepId:e}=P();(t||e)&&D();const i=W("t")||void 0;i&&H("t");const n=W(h)||void 0;n&&H(h);const o=W("err")||void 0;o&&H("err");const{redirectAuthCodeChallenge:r,redirectAuthCallbackUrl:s,redirectAuthBackupCallbackUri:a,redirectAuthInitiator:l}={redirectAuthCodeChallenge:W(g),redirectAuthCallbackUrl:W(p),redirectAuthBackupCallbackUri:W(f),redirectAuthInitiator:W(v)};(r||s||a||l)&&(H(g),H(p),H(f),H(v));const d=W(y);d&&H(y);const c=W(w);c&&H(w);const u=W(I);c&&H(I);const m=W(k);m&&H(k);const b=W(A);b&&H(A);const S=W(C);return S&&H(C),{executionId:t,stepId:e,token:i,code:n,exchangeError:o,redirectAuthCodeChallenge:r,redirectAuthCallbackUrl:s,redirectAuthBackupCallbackUri:a,redirectAuthInitiator:l,oidcIdpStateId:d,samlIdpStateId:c,samlIdpUsername:u,descopeIdpInitiated:"true"===m,ssoAppId:b,oidcLoginHint:S}},F=t=>{let e,i;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e&&(a=o,(s=e).length===a.length&&s.every(((t,e)=>t===a[e])))||(e=o,i=t(...o)),i;var s,a}},_=(t,e,i,n,o,r)=>t&&!e&&t&&!i&&!n&&t&&!o&&t&&!r,K=t=>null==t?void 0:t.submit(),V=(t,e)=>{const i=e.find((e=>t[e]));return i?t[i]:null};var B,J,z,$;function Q(t,e){const i=Object.getOwnPropertyNames(t),n=Object.getOwnPropertyNames(e);if(i.length!==n.length)return!1;for(let o=0;o<i.length;o+=1){const n=i[o],r=t[n],s=e[n];if(null===r||null===s){if(r!==s)return!1}else if("object"==typeof r&&"object"==typeof s){if(!Q(r,s))return!1}else if(r!==s)return!1}return!0}class X{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{updateOnlyOnChange:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};B.set(this,void 0),J.set(this,{}),z.set(this,0),$.set(this,!1),this.update=t=>{const e="function"==typeof t?t((0,n.gn)(this,B,"f")):t,i=Object.assign(Object.assign({},(0,n.gn)(this,B,"f")),e);if(!(0,n.gn)(this,$,"f")||!Q((0,n.gn)(this,B,"f"),i)){const t=(0,n.gn)(this,B,"f");(0,n.GG)(this,B,i,"f"),Object.freeze((0,n.gn)(this,B,"f")),setTimeout((()=>{Object.values((0,n.gn)(this,J,"f")).forEach((e=>e(i,t,((t,e)=>i=>t[i]!==e[i])(i,t))))}),0)}},(0,n.GG)(this,B,t,"f"),(0,n.GG)(this,$,e,"f")}get current(){return Object.assign({},(0,n.gn)(this,B,"f"))}subscribe(t){return(0,n.GG)(this,z,(0,n.gn)(this,z,"f")+1,"f"),(0,n.gn)(this,J,"f")[(0,n.gn)(this,z,"f")]=t,(0,n.gn)(this,z,"f").toString()}unsubscribe(t){const e=!!(0,n.gn)(this,J,"f")[t];return e&&delete(0,n.gn)(this,J,"f")[t],e}unsubscribeAll(){return(0,n.GG)(this,J,{},"f"),!0}}B=new WeakMap,J=new WeakMap,z=new WeakMap,$=new WeakMap;const Y=(t,e)=>{Object.entries(e||{}).forEach((e=>{let[i,n]=e;Array.from(t.querySelectorAll('*[name="'.concat(i,'"]:not([').concat(m,"])"))).forEach((t=>{t.value=n}))}))},Z=(t,e)=>t.replace(/{{(.+?)}}/g,((t,i)=>{return n=e,i.split(".").reduce(((t,e)=>(null==t?void 0:t[e])||""),n);var n})),tt=F((()=>(0,n.sH)(void 0,void 0,void 0,(function*(){var t,e,i,n;if(!window.PublicKeyCredential||!PublicKeyCredential.isConditionalMediationAvailable||!PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)return!1;try{const o=Promise.all([null===(t=window.PublicKeyCredential)||void 0===t?void 0:t.isConditionalMediationAvailable(),null===(e=window.PublicKeyCredential)||void 0===e?void 0:e.isUserVerifyingPlatformAuthenticatorAvailable()]).then((t=>t.every((t=>!!t)))),r=(()=>{var t;const e=null===(t=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===t?void 0:t.brands,i=null==e?void 0:e.find((t=>{let{brand:e,version:i}=t;return"Chromium"===e&&parseFloat(i)}));return i?i.version:0})()>=108;return yield(100,i=o,n=r,new Promise(((t,e)=>{let o=!1;const r=setTimeout((()=>{o=!0,void 0!==n?t(n):e(new Error("Promise timed out after ".concat(100," ms")))}),100);i.then((e=>{o||(clearTimeout(r),t(e))})).catch((t=>{o||(clearTimeout(r),e(t))}))})))}catch(t){return console.error("Conditional login check failed",t),!1}})))),et={"lastAuth.loginId":{"not-empty":t=>!!t.loginId,empty:t=>!t.loginId},idpInitiated:{"is-true":t=>!!t.code,"is-false":t=>!t.code},externalToken:{"is-true":t=>!!t.token,"is-false":t=>!t.token},abTestingKey:{"greater-than":(t,e)=>(t.abTestingKey||0)>e,"less-than":(t,e)=>(t.abTestingKey||0)<e}};function it(t){const e={};if(t)try{Object.assign(e,JSON.parse(localStorage.getItem(b)))}catch(t){}return e}const nt="dls_ab_testing_id",ot=document.createElement("template");var rt,st,at,lt,dt,ct,ut,ht,gt,pt,ft,vt,mt,bt,yt,wt,It,kt,At,Ct,St,Et,xt,jt,Ut,Ot,Lt,Tt,Wt,Ht,Rt,Mt,Gt,Pt,Dt,Nt,qt,Ft,_t,Kt,Vt,Bt,Jt,zt,$t,Qt,Xt,Yt,Zt,te;ot.innerHTML='\n\t<style>\n\t\t:host {\n      all: initial;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\n\t\t#wc-root {\n\t\t\theight: 100%;\n\t\t\ttransition: opacity 300ms ease-in-out;\n\t\t}\n\n\t\t#wc-root[data-theme] {\n\t\t\tbackground-color: transparent;\n\t\t}\n\n\t\t.fade-out {\n\t\t\topacity: 0.1;\n\t\t}\n\n\t</style>\n\t<div id="wc-root"></div>\n\t';class ee extends HTMLElement{static get observedAttributes(){return["project-id","flow-id","base-url","tenant","theme","locale","debug","storage-prefix","preview","redirect-url","auto-focus","store-last-authenticated-user"]}constructor(t){var e;super(),e=this,rt.add(this),this.logger=console,st.set(this,!1),this.loggerWrapper={error:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.logger.error(t,i,new Error),(0,n.gn)(e,rt,"m",Wt).call(e,t,i)},warn:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.logger.warn(t,i)},info:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.logger.info(t,i,n)}},at.set(this,new X({deferredRedirect:!1})),lt.set(this,new X),dt.set(this,{}),this.getComponentsContext=()=>(0,n.gn)(this,dt,"f"),this.nextRequestStatus=new X({isLoading:!1}),ct.set(this,void 0),ut.set(this,{popstate:(0,n.gn)(this,rt,"m",mt).bind(this),visibilitychange:(0,n.gn)(this,rt,"m",bt).bind(this),componentsContext:(0,n.gn)(this,rt,"m",Ut).bind(this)}),ht.set(this,void 0),At.set(this,F((()=>(0,n.sH)(this,void 0,void 0,(function*(){const t=M(this.projectId,a);try{const{body:e,headers:i}=yield R(t,"json");return{projectConfig:e,executionContext:{geo:i["x-geo"]}}}catch(t){return{isMissingConfig:!0}}}))))),St.set(this,void 0),(0,n.GG)(this,ht,t,"f"),(0,n.gn)(this,rt,"m",gt).call(this)}get projectId(){return this.getAttribute("project-id")}get flowId(){return this.getAttribute("flow-id")}get form(){try{const t=JSON.parse(this.getAttribute("form"))||{};return Object.entries(t).reduce(((t,e)=>{let[i,n]=e;return Object.assign(Object.assign({},t),{["form.".concat(i)]:n})}),t)}catch(T){return{}}}get client(){try{return JSON.parse(this.getAttribute("client"))||{}}catch(T){return{}}}get baseUrl(){return this.getAttribute("base-url")||void 0}get tenant(){return this.getAttribute("tenant")||void 0}get redirectUrl(){return this.getAttribute("redirect-url")||void 0}get debug(){return"true"===this.getAttribute("debug")}get locale(){return this.getAttribute("locale")||void 0}get theme(){var t,e;const i=this.getAttribute("theme");return"os"===i?window.matchMedia&&(null===(e=null===(t=window.matchMedia)||void 0===t?void 0:t.call(window,"(prefers-color-scheme: dark)"))||void 0===e?void 0:e.matches)?"dark":"light":i||"light"}get autoFocus(){var t;const e=null!==(t=this.getAttribute("auto-focus"))&&void 0!==t?t:"true";return"skipFirstScreen"===e?e:"true"===e}get storeLastAuthenticatedUser(){var t;return"true"===(null!==(t=this.getAttribute("store-last-authenticated-user"))&&void 0!==t?t:"true")}get storagePrefix(){return this.getAttribute("storage-prefix")||""}get preview(){return!!this.getAttribute("preview")}getExecutionContext(){return(0,n.sH)(this,void 0,void 0,(function*(){const{executionContext:t}=yield(0,n.gn)(this,At,"f").call(this);return t}))}getProjectConfig(){return(0,n.sH)(this,void 0,void 0,(function*(){const{projectConfig:t}=yield(0,n.gn)(this,At,"f").call(this);return t}))}getFlowConfig(){var t,e;return(0,n.sH)(this,void 0,void 0,(function*(){const i=yield this.getProjectConfig(),n=(null===(t=null==i?void 0:i.flows)||void 0===t?void 0:t[this.flowId])||{};return null!==(e=n.version)&&void 0!==e||(n.version=0),n}))}getTargetLocales(){return(0,n.sH)(this,void 0,void 0,(function*(){const t=yield this.getFlowConfig();return((null==t?void 0:t.targetLocales)||[]).map((t=>t.toLowerCase()))}))}connectedCallback(){return(0,n.sH)(this,void 0,void 0,(function*(){if(this.shadowRoot.isConnected){if((0,n.gn)(this,lt,"f").subscribe((0,n.gn)(this,rt,"m",Tt).bind(this)),(0,n.gn)(this,lt,"f").update({isDebug:this.debug}),(0,n.gn)(this,rt,"m",pt).call(this))return void(0,n.gn)(this,rt,"m",ft).call(this);if((0,n.gn)(this,rt,"m",vt).call(this),(0,n.GG)(this,St,(0,n.gn)(this,rt,"m",Ct).call(this),"f"),yield(0,n.gn)(this,rt,"m",It).call(this))return void this.loggerWrapper.error("This SDK version does not support your flows version","Make sure to upgrade your flows to the latest version or use an older SDK version");if((yield(0,n.gn)(this,At,"f").call(this)).isMissingConfig)return void this.loggerWrapper.error("Cannot get config file","Make sure that your projectId & flowId are correct");(0,n.gn)(this,rt,"m",Et).call(this),yield(0,n.gn)(this,rt,"m",Mt).call(this),yield(0,n.gn)(this,rt,"m",xt).call(this),(0,n.gn)(this,rt,"m",Ht).call(this);const{executionId:t,stepId:e,token:i,code:o,exchangeError:r,redirectAuthCallbackUrl:s,redirectAuthBackupCallbackUri:a,redirectAuthCodeChallenge:l,redirectAuthInitiator:d,oidcIdpStateId:c,samlIdpStateId:u,samlIdpUsername:h,descopeIdpInitiated:g,ssoAppId:p,oidcLoginHint:f}=q();window.addEventListener("popstate",(0,n.gn)(this,ut,"f").popstate),window.addEventListener("components-context",(0,n.gn)(this,ut,"f").componentsContext),window.addEventListener("visibilitychange",(0,n.gn)(this,ut,"f").visibilitychange),(0,n.gn)(this,at,"f").subscribe((0,n.gn)(this,rt,"m",wt).bind(this)),(0,n.gn)(this,at,"f").update({projectId:this.projectId,flowId:this.flowId,baseUrl:this.baseUrl,tenant:this.tenant,redirectUrl:this.redirectUrl,locale:this.locale,stepId:e,executionId:t,token:i,code:o,exchangeError:r,redirectAuthCallbackUrl:s,redirectAuthBackupCallbackUri:a,redirectAuthCodeChallenge:l,redirectAuthInitiator:d,oidcIdpStateId:c,samlIdpStateId:u,samlIdpUsername:h,descopeIdpInitiated:g,ssoAppId:p,oidcLoginHint:f}),(0,n.GG)(this,st,!0,"f")}}))}disconnectedCallback(){(0,n.gn)(this,at,"f").unsubscribeAll(),(0,n.gn)(this,lt,"f").unsubscribeAll(),(0,n.gn)(this,rt,"m",Lt).call(this),window.removeEventListener("popstate",(0,n.gn)(this,ut,"f").popstate),window.removeEventListener("visibilitychange",(0,n.gn)(this,ut,"f").visibilitychange),window.removeEventListener("components-context",(0,n.gn)(this,ut,"f").componentsContext)}attributeChangedCallback(t,e,i){if(this.shadowRoot.isConnected&&(0,n.gn)(this,st,"f")&&e!==i&&ee.observedAttributes.includes(t)){(0,n.gn)(this,rt,"m",vt).call(this);const o=null===e;(0,n.gn)(this,at,"f").update((e=>{let{stepId:n,executionId:r}=e,s=n,a=r;return o||(a=null,s=null,D()),{[N(t)]:i,stepId:s,executionId:a}})),(0,n.gn)(this,lt,"f").update({isDebug:this.debug})}}}st=new WeakMap,at=new WeakMap,lt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakMap,At=new WeakMap,St=new WeakMap,rt=new WeakSet,gt=function(){this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(ot.content.cloneNode(!0)),this.rootElement=this.shadowRoot.querySelector("#wc-root")},pt=function(){return!this.shadowRoot.host.closest("form")&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},ft=function(){const t=this.shadowRoot.host,e=document.createElement("form");t.parentElement.appendChild(e),e.appendChild(t)},vt=function(){const t=["base-url","tenant","theme","locale","debug","redirect-url","auto-focus","store-last-authenticated-user","preview","storage-prefix","form","client"];if(ee.observedAttributes.forEach((e=>{if(!t.includes(e)&&!this[N(e)])throw Error("".concat(e," cannot be empty"))})),this.theme&&"light"!==this.theme&&"dark"!==this.theme)throw Error('Supported theme values are "light", "dark", or leave empty for using the OS theme')},mt=function(){const{stepId:t,executionId:e}=P();(0,n.gn)(this,at,"f").update({stepId:t,executionId:e})},bt=function(){document.hidden||setTimeout((()=>{(0,n.gn)(this,at,"f").update({deferredRedirect:!1})}),300)},yt=function(t,e){var i=this;this.sdk=(0,o.Ay)(Object.assign(Object.assign({persistTokens:!0,preview:this.preview,storagePrefix:this.storagePrefix,storeLastAuthenticatedUser:this.storeLastAuthenticatedUser},ee.sdkConfigOverrides),{projectId:t,baseUrl:e})),["start","next"].forEach((t=>{const e=this.sdk.flow[t];this.sdk.flow[t]=function(){for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return(0,n.sH)(i,void 0,void 0,(function*(){this.nextRequestStatus.update({isLoading:!0});try{return yield e(...o)}finally{this.nextRequestStatus.update({isLoading:!1})}}))}}))},wt=function(t,e,i){return(0,n.sH)(this,void 0,void 0,(function*(){const{projectId:e,baseUrl:o}=t;if(i("projectId")||i("baseUrl")){if(!e)return;(0,n.gn)(this,rt,"m",yt).call(this,e,o)}(0,n.gn)(this,ht,"f").call(this,t)}))},It=function(){return(0,n.sH)(this,void 0,void 0,(function*(){return(yield(0,n.gn)(this,At,"f").call(this)).isMissingConfig&&(yield(0,n.gn)(this,rt,"m",kt).call(this))}))},kt=function(){return(0,n.sH)(this,void 0,void 0,(function*(){const t=M(this.projectId,a,"v2-alpha");try{return yield R(t,"json"),!0}catch(t){return!1}}))},Ct=function(){return(0,n.sH)(this,void 0,void 0,(function*(){const t=M(this.projectId,"theme.json");try{const{body:e}=yield R(t,"json");return e}catch(t){return void this.loggerWrapper.error("Cannot fetch theme file","make sure that your projectId & flowId are correct")}}))},Et=function(){var t,e;return(0,n.sH)(this,void 0,void 0,(function*(){const{projectConfig:i}=yield(0,n.gn)(this,At,"f").call(this),o=null===(e=null===(t=null==i?void 0:i.cssTemplate)||void 0===t?void 0:t[this.theme])||void 0===e?void 0:e.fonts;o&&Object.values(o).forEach((t=>(t=>{if(!t)return;const e=document.createElement("link");e.href=t,e.rel="stylesheet",document.head.appendChild(e)})(t.url)))}))},xt=function(){return(0,n.sH)(this,void 0,void 0,(function*(){yield(0,n.gn)(this,rt,"m",jt).call(this),yield(0,n.gn)(this,rt,"m",Ot).call(this)}))},jt=function(){var t,e,i,o;return(0,n.sH)(this,void 0,void 0,(function*(){const r=document.createElement("style"),s=yield(0,n.gn)(this,St,"f");r.innerText=((null===(t=null==s?void 0:s.light)||void 0===t?void 0:t.globals)||"")+((null===(e=null==s?void 0:s.dark)||void 0===e?void 0:e.globals)||"");const a=yield ee.descopeUI;(null==a?void 0:a.componentsThemeManager)&&(a.componentsThemeManager.themes={light:null===(i=null==s?void 0:s.light)||void 0===i?void 0:i.components,dark:null===(o=null==s?void 0:s.dark)||void 0===o?void 0:o.components}),this.shadowRoot.appendChild(r)}))},Ut=function(t){(0,n.GG)(this,dt,Object.assign(Object.assign({},t.detail),(0,n.gn)(this,dt,"f")),"f")},Ot=function(){return(0,n.sH)(this,void 0,void 0,(function*(){this.rootElement.setAttribute("data-theme",this.theme);const t=yield ee.descopeUI;(null==t?void 0:t.componentsThemeManager)&&(t.componentsThemeManager.currentThemeName=this.theme)}))},Lt=function(){var t;null===(t=(0,n.gn)(this,ct,"f"))||void 0===t||t.remove(),(0,n.GG)(this,ct,null,"f")},Tt=function(t){let{isDebug:e}=t;return(0,n.sH)(this,void 0,void 0,(function*(){e?((0,n.GG)(this,ct,document.createElement("descope-debugger"),"f"),Object.assign((0,n.gn)(this,ct,"f").style,{position:"fixed",top:"0",right:"0",height:"100vh",width:"100vw",pointerEvents:"none",zIndex:99999}),yield i.e(352).then(i.bind(i,352)),document.body.appendChild((0,n.gn)(this,ct,"f"))):(0,n.gn)(this,rt,"m",Lt).call(this)}))},Wt=function(t,e){var i;t&&this.debug&&(null===(i=(0,n.gn)(this,ct,"f"))||void 0===i||i.updateData({title:t,description:e}))},Ht=function(){this.rootElement.onkeydown=t=>{var e,i,n;const o=!!(null===(e=this.shadowRoot.activeElement)||void 0===e?void 0:e.getAttribute("href")),r=O.includes(null!==(n=null===(i=this.shadowRoot.activeElement)||void 0===i?void 0:i.localName)&&void 0!==n?n:"");if("Enter"!==t.key||o||r)return;t.preventDefault();const s=this.rootElement.querySelectorAll("descope-button");if(1===s.length&&"false"!==s[0].getAttribute("auto-submit"))return void s[0].click();const a=Array.from(s).filter((t=>"true"===t.getAttribute("auto-submit")));if(1===a.length)return void a[0].click();const l=Array.from(s).filter((t=>"button"===t.getAttribute("data-type")));if(1===l.length)"false"!==l[0].getAttribute("auto-submit")&&l[0].click();else if(0===l.length){const t=Array.from(s).filter((t=>"sso"===t.getAttribute("data-type")));1===t.length&&"false"!==t[0].getAttribute("auto-submit")&&t[0].click()}}},Rt=function(){var t,e;return(0,n.sH)(this,void 0,void 0,(function*(){return(null===(e=null===(t=yield(0,n.gn)(this,At,"f").call(this))||void 0===t?void 0:t.projectConfig)||void 0===e?void 0:e.componentsVersion)||(this.logger.error("Did not get components version, using latest version"),"latest")}))},Mt=function(){return(0,n.sH)(this,void 0,void 0,(function*(){ee.descopeUI?this.loggerWrapper.info("DescopeUI is already loading, probably multiple flows are running on the same page"):ee.descopeUI=new Promise((t=>{if(globalThis.DescopeUI)return void t(globalThis.DescopeUI);const e=t=>{const e=document.createElement("script");return e.id="load-descope-ui",e.src=t,e},i=(t,e)=>t.replace("<version>",e),o=(e,i)=>{const n=()=>{this.loggerWrapper.error("Cannot load DescopeUI",'Make sure this URL is valid and return the correct script: "'.concat(e.src,'"')),i()};e.addEventListener("load",(()=>{globalThis.DescopeUI||n(),t(globalThis.DescopeUI)})),e.addEventListener("error",n)};(()=>{(0,n.sH)(this,void 0,void 0,(function*(){const r=yield(0,n.gn)(this,rt,"m",Rt).call(this),s=e(i(d,r));o(s,(()=>{s.remove(),this.loggerWrapper.info("Trying to load DescopeUI from a fallback URL");const n=e(i(c,r));o(n,(()=>{t(void 0)})),document.body.append(n)})),document.body.append(s)}))})()}))}))},ee.sdkConfigOverrides={baseHeaders:{"x-descope-sdk-name":"web-component","x-descope-sdk-version":"3.8.32"}};class ie extends ee{static set sdkConfigOverrides(t){ee.sdkConfigOverrides=t}constructor(){const t=new X;super(t.update.bind(t)),Gt.add(this),this.stepState=new X({},{updateOnlyOnChange:!1}),Pt.set(this,void 0),Dt.set(this,null),Nt.set(this,((t,e,i,o,r)=>{i===E&&(0,n.GG)(this,Pt,setTimeout((()=>(0,n.sH)(this,void 0,void 0,(function*(){var i;const s=yield this.sdk.flow.next(t,e,U,o,r,{});(0,n.gn)(this,Ft,"f").call(this,s);const{action:a}=null!==(i=null==s?void 0:s.data)&&void 0!==i?i:{};(0,n.gn)(this,Nt,"f").call(this,t,e,a,o,r)}))),2e3),"f")})),qt.set(this,(()=>{clearTimeout((0,n.gn)(this,Pt,"f")),(0,n.GG)(this,Pt,null,"f")})),Ft.set(this,(t=>{var e,i,o,s,a,l,d,c,u;if(!(null==t?void 0:t.ok)){(0,n.gn)(this,Gt,"m",te).call(this,"error",null==t?void 0:t.error);const r=null===(e=null==t?void 0:t.response)||void 0===e?void 0:e.url,l="".concat(null===(i=null==t?void 0:t.response)||void 0===i?void 0:i.status," - ").concat(null===(o=null==t?void 0:t.response)||void 0===o?void 0:o.statusText);return void this.loggerWrapper.error((null===(s=null==t?void 0:t.error)||void 0===s?void 0:s.errorDescription)||r,(null===(a=null==t?void 0:t.error)||void 0===a?void 0:a.errorMessage)||l)}const h=null===(c=null===(d=null===(l=t.data)||void 0===l?void 0:l.screen)||void 0===d?void 0:d.state)||void 0===c?void 0:c.errorText;(null===(u=t.data)||void 0===u?void 0:u.error)?this.loggerWrapper.error("[".concat(t.data.error.code,"]: ").concat(t.data.error.description),"".concat(h?"".concat(h," - "):"").concat(t.data.error.message)):h&&this.loggerWrapper.error(h);const{status:g,authInfo:p,lastAuth:f}=t.data;if("completed"===g)return this.storeLastAuthenticatedUser&&function(t){(null==t?void 0:t.authMethod)&&r&&localStorage.setItem(b,JSON.stringify(t))}(f),void(0,n.gn)(this,Gt,"m",te).call(this,"success",p);const{executionId:v,stepId:m,stepName:y,action:w,screen:I,redirect:k,webauthn:A,error:C,samlIdpResponse:S}=t.data;w!==E?(this.loggerWrapper.info('Step "'.concat(y||"#".concat(m),'" is ').concat(g),"",{screen:I,status:g,stepId:m,stepName:y,action:w,error:C}),this.flowState.update({stepId:m,executionId:v,action:w,redirectTo:null==k?void 0:k.url,screenId:null==I?void 0:I.id,screenState:null==I?void 0:I.state,webauthnTransactionId:null==A?void 0:A.transactionId,webauthnOptions:null==A?void 0:A.options,samlIdpResponseUrl:null==S?void 0:S.url,samlIdpResponseSamlResponse:null==S?void 0:S.samlResponse,samlIdpResponseRelayState:null==S?void 0:S.relayState})):this.flowState.update({action:w})})),_t.set(this,F((()=>(0,n.sH)(this,void 0,void 0,(function*(){var t;try{const e=yield this.sdk.webauthn.signIn.start("",window.location.origin);return e.ok||this.loggerWrapper.warn("Webauthn start failed",null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.errorMessage),e.data}catch(t){this.loggerWrapper.warn("Webauthn start failed",t.message)}}))))),Qt.set(this,function(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];e||t.apply(this,o),clearTimeout(e),e=setTimeout((()=>{e=null}),i)}}(((t,e)=>(0,n.sH)(this,void 0,void 0,(function*(){if("true"===t.getAttribute("formnovalidate")||(0,n.gn)(this,Gt,"m",Bt).call(this)){const o=null==t?void 0:t.getAttribute("id");(0,n.gn)(this,Gt,"m",zt).call(this,t);const r=yield(0,n.gn)(this,Gt,"m",Jt).call(this),s=(i=t,Array.from((null==i?void 0:i.attributes)||[]).reduce(((t,e)=>{var i;const n=null===(i=new RegExp("^data-descope-(\\S+)$").exec(e.name))||void 0===i?void 0:i[1];return n?Object.assign(t,{[n]:e.value}):t}),{})),a=this.getComponentsContext(),l=Object.assign(Object.assign(Object.assign(Object.assign({},a),s),r),{origin:window.location.origin}),d=yield this.getFlowConfig(),c=yield this.getProjectConfig(),u=yield e(o,d.version,c.componentsVersion,l);(0,n.gn)(this,Ft,"f").call(this,u),(0,n.gn)(this,Gt,"m",$t).call(this,r)}var i}))))),this.flowState=t}connectedCallback(){const t=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});var e,i;return(0,n.sH)(this,void 0,void 0,(function*(){this.shadowRoot.isConnected&&(null===(e=this.flowState)||void 0===e||e.subscribe(this.onFlowChange.bind(this)),null===(i=this.stepState)||void 0===i||i.subscribe(this.onStepChange.bind(this))),yield t.connectedCallback.call(this)}))}disconnectedCallback(){var t;super.disconnectedCallback(),this.flowState.unsubscribeAll(),this.stepState.unsubscribeAll(),null===(t=(0,n.gn)(this,Dt,"f"))||void 0===t||t.abort(),(0,n.GG)(this,Dt,null,"f")}getHtmlFilenameWithLocale(t,e){return(0,n.sH)(this,void 0,void 0,(function*(){let i,n=navigator.language;n&&"zh-TW"!==n&&(n=n.split("-")[0]);const o=(t||n||"").toLowerCase();return(yield this.getTargetLocales()).includes(o)&&(i="".concat(e,"-").concat(o,".html")),i}))}getPageContent(t,e){return(0,n.sH)(this,void 0,void 0,(function*(){if(e)try{const{body:t}=yield R(e,"text");return t}catch(T){this.loggerWrapper.error("Failed to fetch flow page from ".concat(e,". Fallback to url ").concat(t),T)}try{const{body:e}=yield R(t,"text");return e}catch(T){this.loggerWrapper.error("Failed to fetch flow page",T.message)}return null}))}onFlowChange(t,e,i){var r,s;return(0,n.sH)(this,void 0,void 0,(function*(){var a=this;const{projectId:l,flowId:d,tenant:c,stepId:u,executionId:h,action:g,screenId:p,screenState:f,redirectTo:v,redirectUrl:m,token:b,code:y,exchangeError:w,webauthnTransactionId:I,webauthnOptions:k,redirectAuthCodeChallenge:A,redirectAuthCallbackUrl:C,redirectAuthBackupCallbackUri:S,redirectAuthInitiator:E,oidcIdpStateId:U,locale:O,samlIdpStateId:L,samlIdpUsername:T,descopeIdpInitiated:W,samlIdpResponseUrl:H,samlIdpResponseSamlResponse:R,samlIdpResponseRelayState:P,ssoAppId:D,oidcLoginHint:N}=t;let q,F;const V=(()=>{const t=localStorage.getItem(nt);if(!t){const t=Math.floor(100*Math.random()+1);return localStorage.setItem(nt,t.toString()),t}return Number(t)})(),B=this.sdk.getLastUserLoginId(),J=yield this.getFlowConfig(),z=yield this.getProjectConfig(),$=C&&A?{callbackUrl:C,codeChallenge:A,backupCallbackUri:S}:void 0;if(!h&&(J.fingerprintEnabled&&J.fingerprintKey?yield(0,o.bv)(J.fingerprintKey,this.baseUrl):(0,o.g0)(),J.conditions?({startScreenId:q,conditionInteractionId:F}=((t,e)=>{const i=null==e?void 0:e.find((e=>{let{key:i,operator:n,predicate:o}=e;var r;if("ELSE"===i)return!0;const s=null===(r=et[i])||void 0===r?void 0:r[n];return!!(null==s?void 0:s(t,o))}));return i?{startScreenId:i.met.screenId,conditionInteractionId:i.met.interactionId}:{}})({loginId:B,code:y,token:b,abTestingKey:V},J.conditions)):J.condition?({startScreenId:q,conditionInteractionId:F}=((t,e)=>{var i;const n=null===(i=et[null==t?void 0:t.key])||void 0===i?void 0:i[t.operator];if(!n)return{};const o=n(e,t.predicate)?t.met:t.unmet;return{startScreenId:null==o?void 0:o.screenId,conditionInteractionId:null==o?void 0:o.interactionId}})(J.condition,{loginId:B,code:y,token:b,abTestingKey:V})):q=J.startScreenId,!_(q,U,L,T,D,N))){const t=yield this.sdk.flow.start(d,Object.assign(Object.assign({tenant:c,redirectAuth:$,oidcIdpStateId:U,samlIdpStateId:L,samlIdpUsername:T,ssoAppId:D,oidcLoginHint:N,client:this.client},m&&{redirectUrl:m}),{lastAuth:it(B),abTestingKey:V}),F,"",J.version,z.componentsVersion,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.form),y?{exchangeCode:y,idpInitiated:!0}:{}),W&&{idpInitiated:!0}),b?{token:b}:{}),N?{externalId:N}:{}));return(0,n.gn)(this,Ft,"f").call(this,t),void("completed"!==(null===(r=null==t?void 0:t.data)||void 0===r?void 0:r.status)&&this.flowState.update({code:void 0,token:void 0}))}if(h&&(i("token")&&b||i("code")&&y||i("exchangeError")&&w)){const t=yield this.sdk.flow.next(h,u,j,J.version,z.componentsVersion,{token:b,exchangeCode:y,exchangeError:w});return(0,n.gn)(this,Ft,"f").call(this,t),void this.flowState.update({token:void 0,code:void 0,exchangeError:void 0})}if("loadForm"===g&&["samlIdpResponseUrl","samlIdpResponseSamlResponse","samlIdpResponseRelayState"].some((t=>i(t)))){if(!H||!R)return void this.loggerWrapper.error("Did not get saml idp params data to load");((t,e,i,n)=>{const o=document.createElement("form");o.method="POST",o.action=t,o.innerHTML='\n  <input type="hidden" role="saml-response" name="SAMLResponse" value="'.concat(e,'" />\n  <input type="hidden" role="saml-relay-state" name="RelayState" value="').concat(i,'" />\n  <input style="display: none;" id="SAMLSubmitButton" type="submit" value="Continue" />\n  '),document.body.appendChild(o),n(o)})(H,R,P||"",K)}if("redirect"===g&&(i("redirectTo")||i("deferredRedirect")))return v?"android"===E&&document.hidden?void this.flowState.update({deferredRedirect:!0}):void window.location.assign(v):void this.loggerWrapper.error("Did not get redirect url");if(g===x||"webauthnGet"===g){if(!I||!k)return void this.loggerWrapper.error("Did not get webauthn transaction id or options");let t,e;null===(s=(0,n.gn)(this,Dt,"f"))||void 0===s||s.abort(),(0,n.GG)(this,Dt,null,"f");try{t=g===x?yield this.sdk.webauthn.helpers.create(k):yield this.sdk.webauthn.helpers.get(k)}catch(l){"InvalidStateError"===l.name?this.loggerWrapper.warn("WebAuthn operation failed",l.message):"NotAllowedError"!==l.name&&this.loggerWrapper.error(l.message),e=l.name}const i=yield this.sdk.flow.next(h,u,j,J.version,z.componentsVersion,{transactionId:I,response:t,failure:e});(0,n.gn)(this,Ft,"f").call(this,i)}if((0,n.gn)(this,Nt,"f").call(this,h,u,g,J.version,z.componentsVersion),!p&&!q)return void this.loggerWrapper.warn("No screen was found to show");const Q=q||p,X=yield this.getHtmlFilenameWithLocale(O,Q),Y={direction:G(+u,+e.stepId),screenState:Object.assign(Object.assign({},f),{form:Object.assign(Object.assign({},this.form),null==f?void 0:f.form),lastAuth:{loginId:B,name:this.sdk.getLastUserDisplayName()||B}}),htmlUrl:M(l,"".concat(Q,".html")),htmlLocaleUrl:X&&M(l,X),samlIdpUsername:T,oidcLoginHint:N},Z=it(B);_(q,U,L,T,D,N)?Y.next=(t,e,i,n)=>this.sdk.flow.start(d,Object.assign({tenant:c,redirectAuth:$,oidcIdpStateId:U,samlIdpStateId:L,samlIdpUsername:T,ssoAppId:D,oidcLoginHint:N,lastAuth:Z,preview:this.preview,abTestingKey:V,client:this.client},m&&{redirectUrl:m}),F,t,e,i,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.form),n),y&&{exchangeCode:y,idpInitiated:!0}),W&&{idpInitiated:!0}),b&&{token:b})):(i("projectId")||i("baseUrl")||i("executionId")||i("stepId"))&&(Y.next=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return a.sdk.flow.next(h,u,...e)}),this.stepState.update(Y)}))}loadDescopeUiComponents(t){return(0,n.sH)(this,void 0,void 0,(function*(){const e=yield ee.descopeUI;if(!e)return;const i=(t=>[...Array.from(t.querySelectorAll("*")).reduce(((t,e)=>e.tagName.startsWith("DESCOPE-")?t.add(e.tagName.toLocaleLowerCase()):t),new Set)])(t);yield Promise.all(i.map((t=>(0,n.sH)(this,void 0,void 0,(function*(){if(!customElements.get(t))if(e[t])try{return yield e[t]()}catch(T){if("NotSupportedError"!==T.name)throw T;console.debug("".concat(t," is already registered"))}else this.loggerWrapper.error('Cannot load UI component "'.concat(t,'"'),'Descope UI does not have a component named "'.concat(t,'", available components are: "').concat(Object.keys(e).join(", "),'"'))})))))}))}onStepChange(t,e){var i,o;return(0,n.sH)(this,void 0,void 0,(function*(){const{htmlUrl:r,htmlLocaleUrl:s,direction:a,next:l,screenState:d}=t,c=document.createElement("template");c.innerHTML=yield this.getPageContent(r,s);const u=c.content.cloneNode(!0),h=this.loadDescopeUiComponents(c.content);this.sdk.webauthn.helpers.isSupported()?yield(0,n.gn)(this,Gt,"m",Vt).call(this,u,l):u.querySelectorAll("descope-button[".concat(S,'="biometrics"]')).forEach((t=>t.setAttribute("disabled","true"))),!t.samlIdpUsername||(null===(i=d.form)||void 0===i?void 0:i.loginId)||(null===(o=d.form)||void 0===o?void 0:o.email)||(d.form||(d.form={}),d.form.loginId=t.samlIdpUsername,d.form.email=t.samlIdpUsername),((t,e,i,n,o)=>{var r;let s=null==e?void 0:e.errorText;try{s=(null==n?void 0:n({text:null==e?void 0:e.errorText,type:null==e?void 0:e.errorType}))||(null==e?void 0:e.errorText)}catch(t){o.error("Error transforming error message",t.message)}(function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.querySelectorAll("[".concat(S,'="').concat(e,'"]')).forEach((t=>{t.textContent=i,t.classList[i?"remove":"add"]("hide")}))})(t,"error-message",s),((t,e)=>{t.querySelectorAll("[".concat(S,'="totp-link"]')).forEach((t=>{t.setAttribute("href",e)}))})(t,null===(r=null==e?void 0:e.totp)||void 0===r?void 0:r.provisionUrl),((t,e)=>{t.querySelectorAll("descope-text,descope-link").forEach((t=>{t.textContent=Z(t.textContent,e)}))})(t,e),((t,e,i)=>{e&&Object.keys(e).forEach((n=>{t.querySelectorAll("[name=".concat(n,"]")).forEach((t=>{const o=e[n];Object.keys(o).forEach((e=>{let n=o[e];if("string"!=typeof n)try{n=JSON.stringify(n)}catch(t){i.error('Could not stringify value "'.concat(n,'" for "').concat(e,'"'),t.message),n=""}t.setAttribute(e,n)}))}))}))})(t,i,o),((t,e)=>{t.querySelectorAll("[data-has-dynamic-attr-values]").forEach((t=>{Array.from(t.attributes).forEach((t=>{t.value=Z(t.value,e)}))}))})(t,e)})(u,d,d.componentsConfig,this.errorTransformer,this.loggerWrapper);const{geo:g}=yield this.getExecutionContext();((t,e)=>{Array.from(t.querySelectorAll('descope-phone-field[default-code="autoDetect"]')).forEach((t=>{t.setAttribute("default-code",e)}))})(u,g);const p=()=>(0,n.sH)(this,void 0,void 0,(function*(){var t;yield h,((t,e)=>{var i,n;const o=null===(i=customElements.get("descope-totp-image"))||void 0===i?void 0:i.cssVarList.url;e&&o&&(null===(n=null==t?void 0:t.style)||void 0===n||n.setProperty(o,"url(data:image/jpg;base64,".concat(e,")")))})(this.shadowRoot.querySelector("div"),null===(t=null==d?void 0:d.totp)||void 0===t?void 0:t.image),this.rootElement.replaceChildren(u),setTimeout((()=>((t,e)=>{Y(t,null==e?void 0:e.inputs),Y(t,null==e?void 0:e.form)})(this.rootElement,d)));const i=!e.htmlUrl;if(((t,e,i)=>{if(!0===e||"skipFirstScreen"===e&&!i){const e=t.querySelector("*[name]");setTimeout((()=>{null==e||e.focus()}))}})(this.rootElement,this.autoFocus,i),(0,n.gn)(this,Gt,"m",Yt).call(this,l),i&&(0,n.gn)(this,Gt,"m",te).call(this,"ready",{}),(0,n.gn)(this,Gt,"m",te).call(this,"page-updated",{}),this.rootElement.querySelector("[".concat(S,'="polling"]'))){const t=yield this.getFlowConfig(),e=yield this.getProjectConfig(),i=yield l(U,t.version,e.componentsVersion,{});(0,n.gn)(this,Ft,"f").call(this,i)}}));a?(0,n.gn)(this,Gt,"m",Zt).call(this,p,a):p()}))}}Pt=new WeakMap,Dt=new WeakMap,Nt=new WeakMap,qt=new WeakMap,Ft=new WeakMap,_t=new WeakMap,Qt=new WeakMap,Gt=new WeakSet,Kt=function(t){const e=t.getAttribute("name");if(!["email"].includes(e)){const i="user-".concat(e);t.setAttribute("name",i),t.addEventListener("input",(()=>{t.setAttribute("name",t.value?e:i)}))}},Vt=function(t,e){var i;return(0,n.sH)(this,void 0,void 0,(function*(){null===(i=(0,n.gn)(this,Dt,"f"))||void 0===i||i.abort();const o=t.querySelector('*[autocomplete="webauthn"]');if(o&&(yield tt())){const{options:t,transactionId:i}=(yield(0,n.gn)(this,_t,"f").call(this))||{};if(t&&i){(0,n.gn)(this,Gt,"m",Kt).call(this,o),(0,n.GG)(this,Dt,new AbortController,"f");const r=yield this.getFlowConfig(),s=yield this.getProjectConfig();this.sdk.webauthn.helpers.conditional(t,(0,n.gn)(this,Dt,"f")).then((t=>(0,n.sH)(this,void 0,void 0,(function*(){const a=yield e(o.id,r.version,s.componentsVersion,{transactionId:i,response:t});(0,n.gn)(this,Ft,"f").call(this,a)})))).catch((t=>{"AbortError"!==t.name&&this.loggerWrapper.error("Conditional login failed",t.message)}))}}}))},Bt=function(){return Array.from(this.shadowRoot.querySelectorAll("*[name]")).every((t=>{var e,i;return null===(e=t.reportValidity)||void 0===e||e.call(t),null===(i=t.checkValidity)||void 0===i?void 0:i.call(t)}))},Jt=function(){return(0,n.sH)(this,void 0,void 0,(function*(){const t=Array.from(this.shadowRoot.querySelectorAll("*[name]:not([".concat(m,"])")));return(yield Promise.all(t.map((t=>(0,n.sH)(this,void 0,void 0,(function*(){return{name:t.getAttribute("name"),value:t.value}})))))).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.name]:e.value})),{})}))},zt=function(t){const e=this.nextRequestStatus.subscribe((i=>{let{isLoading:n}=i;n?t.setAttribute("loading","true"):(this.nextRequestStatus.unsubscribe(e),t.removeAttribute("loading"))}))},$t=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,i;const n=V(t,["externalId","email","phone"]),o=V(t,["newPassword","password"]);if(n&&o)try{const t=new globalThis.PasswordCredential({id:n,password:o});null===(i=null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.store)||void 0===i||i.call(e,t)}catch(t){this.loggerWrapper.error("Could not store credentials",t.message)}},Xt=function(t){this.rootElement.querySelectorAll('descope-passcode[data-auto-submit="true"]').forEach((e=>{e.addEventListener("input",(()=>{var i;(null===(i=e.checkValidity)||void 0===i?void 0:i.call(e))&&(0,n.gn)(this,Qt,"f").call(this,e,t)}))}))},Yt=function(t){this.rootElement.querySelectorAll("descope-button:not([data-exclude-next])").forEach((e=>{e.onclick=()=>{(0,n.gn)(this,Qt,"f").call(this,e,t)}})),(0,n.gn)(this,Gt,"m",Xt).call(this,t)},Zt=function(t,e){this.rootElement.addEventListener("transitionend",(()=>{this.rootElement.classList.remove("fade-out"),t()}),{once:!0});const i=e===L.forward?"slide-forward":"slide-backward";Array.from(this.rootElement.getElementsByClassName("input-container")).forEach(((t,e)=>{t.style["transition-delay"]=40*e+"ms",t.classList.add(i)})),this.rootElement.classList.add("fade-out")},te=function(t,e){this.dispatchEvent(new CustomEvent(t,{detail:e}))},customElements.define("descope-wc",ie)},27:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n.D});var n=i(951);i(710)}}]);
//# sourceMappingURL=27.f28153e5.chunk.js.map